"use strict";const searchInput=document.querySelector(".js-input"),searchBtn=document.querySelector(".js-searchBtn"),serieList=document.querySelector(".js-serieList"),mainContainer=document.querySelector(".js-main"),seriesFavlist=document.querySelector(".js-favAnime");let noList,searchResults;searchBtn.addEventListener("click",searchSerie);let arrAnimes=JSON.parse(localStorage.getItem("favAnimes"));function searchSerie(e){e.preventDefault(),void 0!==noList&&(noList.innerHTML="",noList.classList.remove("notFound")),fetch("https://api.jikan.moe/v3/search/anime?q="+searchInput.value).then(e=>e.json()).then(e=>{if(null===e.results&&(e.results=[]),e.results.length>0)searchResults=e.results,paintSeries(searchResults);else{noList=document.createElement("p"),noList.classList.add("notFound");const e=document.createTextNode("No tenemos la serie que buscas, prueba otra 🙈");noList.appendChild(e),mainContainer.appendChild(noList)}})}function paintSeries(e){serieList.innerHTML="",null===e&&(e=[]);for(const t of e){const e=document.createElement("li"),s=document.createElement("div");if(e.setAttribute("data-mal_id",t.mal_id),e.setAttribute("data-title",t.title),e.setAttribute("data-image_url",t.image_url),e.setAttribute("data-synopsis",t.synopsis),t.image_url){e.style.backgroundImage=`url(${t.image_url})`;const a=document.createTextNode(t.title);s.appendChild(a),s.classList.add("divText")}else e.style.backgroundImage=`url(https://via.placeholder.com/400x400/f96457/ffffff/?text=${t.title})`;serieList.appendChild(e),e.appendChild(s),e.classList.add("listEl"),null===arrAnimes&&(arrAnimes=[]);for(const s of arrAnimes)parseInt(s.mal_id)===t.mal_id&&e.classList.add("favStyle");e.addEventListener("click",addFav)}}function addFav(e){const t=arrAnimes.findIndex(t=>e.currentTarget.dataset.mal_id===t.mal_id);-1===t?(arrAnimes.push(e.currentTarget.dataset),localStorage.setItem("favAnimes",JSON.stringify(arrAnimes)),e.currentTarget.classList.add("favStyle"),paintFavseries(arrAnimes)):(arrAnimes.splice(t,1),localStorage.setItem("favAnimes",JSON.stringify(arrAnimes)),e.currentTarget.classList.remove("favStyle"),paintFavseries(arrAnimes))}function paintFavseries(e){seriesFavlist.innerHTML="";for(const t of e){const e=document.createElement("li"),s=document.createElement("button"),a=document.createTextNode("❌"),i=document.createElement("div"),r=document.createElement("img");r.classList.add("listImg");const n=document.createTextNode(t.title);"https://cdn.myanimelist.net/images/qm_50.gif?s=e1ff92a46db617cb83bfc1e205aff620"===t.image_url?r.setAttribute("src","https://via.placeholder.com/300x400/f96457/ffffff/?text="+t.title):r.setAttribute("src",t.image_url),seriesFavlist.appendChild(i),i.appendChild(e),e.appendChild(n),e.appendChild(r),e.appendChild(s),s.appendChild(a),e.classList.add("listFavel"),i.classList.add("divFav"),s.classList.add("deleteFav"),s.setAttribute("data-mal_id",t.mal_id),s.addEventListener("click",deleteFavourite)}}null===arrAnimes&&(arrAnimes=[]),paintFavseries(arrAnimes);const resetFav=document.querySelector(".js-resetFav"),resetBtn=document.querySelector(".js-resetBtn");function resetSearchseries(){location.reload()}function resetFavseries(){localStorage.setItem("favAnimes","[]"),arrAnimes=[],seriesFavlist.innerHTML="",paintSeries(searchResults)}function deleteFavourite(e){const t=arrAnimes.findIndex(t=>e.currentTarget.dataset.mal_id===t.mal_id);arrAnimes.splice(t,1),localStorage.setItem("favAnimes",JSON.stringify(arrAnimes)),paintFavseries(arrAnimes),paintSeries(searchResults)}resetBtn.addEventListener("click",resetSearchseries),resetFav.addEventListener("click",resetFavseries);